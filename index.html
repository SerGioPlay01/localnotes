<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script>
        // Load Google Analytics with better error handling
        function loadGoogleAnalytics() {
            const script = document.createElement('script');
            script.async = true;
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-HR9HLBQFCR';
            script.onload = function() {
                try {
                    window.dataLayer = window.dataLayer || [];
                    function gtag() { dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-HR9HLBQFCR');
                    console.log('Google Analytics loaded successfully');
                } catch (error) {
                    console.warn('Google Analytics initialization failed:', error);
                }
            };
            script.onerror = function() {
                console.warn('Google Analytics script failed to load - continuing without analytics');
            };
            document.head.appendChild(script);
        }
        
        // Load analytics after a short delay to not block page load
        setTimeout(loadGoogleAnalytics, 100);
    </script>

    <meta charset="UTF-8">
    <meta http-equiv="Permissions-Policy" content="browsing-topics=(), run-ad-auction=(), camera=(), microphone=(), geolocation=()">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: blob: https:; font-src 'self' data: https://fonts.gstatic.com chrome-extension:; connect-src 'self' https://www.google-analytics.com https://analytics.google.com; frame-src 'none'; object-src 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests;">
    
    <!-- Cache busting meta tags -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-buster" content="<script>document.write(Date.now())</script>">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    
    <!-- Mobile Optimization -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Local Notes">
    <meta name="msapplication-TileColor" content="#0a0a0a">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="msapplication-navbutton-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- SEO Meta Tags -->
    <meta property="og:title" content="Local Notes - Save important notes right in your browser">
    <meta property="og:site_name" content="Local Notes">
    <meta property="og:url" content="https://localnotes-web.netlify.app/">
    <meta property="og:description" content="Local Notes is an application for creating and storing notes in your browser.">
    <meta property="og:image" content="/resources/obl_web.jpg">
    <meta property="og:image:width" content="968">
    <meta property="og:image:height" content="504">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="en_US">

    <meta name="description" content="Local Notes is an application for creating and storing notes in your browser.">
    <meta name="keywords" content="local notes, notes, browser notes, note-taking app, online notes, Local Notes">
    <meta name="author" content="SerGio Play">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">

    <!-- Language Detection and Redirect -->
    <script>
        // Language mapping for automatic redirection
        const languageMap = {
            'ru': '/ru/',
            'ua': '/ua/',
            'pl': '/pl/',
            'cs': '/cs/',
            'sk': '/sk/',
            'bg': '/bg/',
            'hr': '/hr/',
            'sr': '/sr/',
            'bs': '/bs/',
            'mk': '/mk/',
            'sl': '/sl/'
        };

        // Get user's preferred language
        function getUserLanguage() {
            // Check URL parameter first
            const urlParams = new URLSearchParams(window.location.search);
            const langParam = urlParams.get('lang');
            if (langParam && languageMap[langParam]) {
                return langParam;
            }

            // Check localStorage
            const savedLang = localStorage.getItem('preferredLanguage');
            if (savedLang && languageMap[savedLang]) {
                return savedLang;
            }

            // Check browser language
            const browserLang = navigator.language || navigator.userLanguage;
            const langCode = browserLang.split('-')[0].toLowerCase();
            
            if (languageMap[langCode]) {
                return langCode;
            }

            // Check for specific country codes
            const countryCode = browserLang.split('-')[1]?.toLowerCase();
            if (countryCode) {
                // Special cases for countries
                if (countryCode === 'ua') return 'ua'; // Ukraine -> Ukrainian
                if (countryCode === 'by') return 'ru'; // Belarus -> Russian
                if (countryCode === 'kz') return 'ru'; // Kazakhstan -> Russian
                if (countryCode === 'md') return 'ru'; // Moldova -> Russian
            }

            // Default to English
            return 'en';
        }

        // Redirect to appropriate language version
        function redirectToLanguage() {
            const userLang = getUserLanguage();
            
            if (userLang !== 'en' && languageMap[userLang]) {
                // Save language preference
                localStorage.setItem('preferredLanguage', userLang);
                
                // Redirect to language-specific version
                window.location.replace(languageMap[userLang]);
                return;
            }
            
            // If English or no specific language, show the main page
            showMainPage();
        }

        // Show main page content
        function showMainPage() {
            // Set English as default language
            window.currentLang = 'en';
            document.body.style.display = 'block';
            // Обновляем текст кнопок после загрузки страницы
            if (typeof updateButtonTexts === 'function') {
                setTimeout(updateButtonTexts, 200);
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            redirectToLanguage();
        });

        // Fallback: show page after 1 second if no redirect happened
        setTimeout(function() {
            if (document.body.style.display === 'none') {
                showMainPage();
            }
        }, 1000);
    </script>

    <!-- Critical CSS loaded first -->
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/preloader.css">
    
    <!-- Non-critical CSS loaded asynchronously -->
    <link rel="preload" href="/css/img.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/css/highlight.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/css/tinymce-custom.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- Fallback for browsers that don't support preload -->
    <noscript>
        <link rel="stylesheet" href="/css/img.css">
        <link rel="stylesheet" href="/css/highlight.css">
        <link rel="stylesheet" href="/css/tinymce-custom.css">
    </noscript>
    
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <link rel="manifest" href="/manifest.json">

    <!-- Hreflang tags for SEO -->
    <link rel="alternate" hreflang="en" href="https://localnotes-web.netlify.app/">
    <link rel="alternate" hreflang="ru" href="https://localnotes-web.netlify.app/ru/">
    <link rel="alternate" hreflang="ua" href="https://localnotes-web.netlify.app/ua/">
    <link rel="alternate" hreflang="pl" href="https://localnotes-web.netlify.app/pl/">
    <link rel="alternate" hreflang="cs" href="https://localnotes-web.netlify.app/cs/">
    <link rel="alternate" hreflang="sk" href="https://localnotes-web.netlify.app/sk/">
    <link rel="alternate" hreflang="bg" href="https://localnotes-web.netlify.app/bg/">
    <link rel="alternate" hreflang="hr" href="https://localnotes-web.netlify.app/hr/">
    <link rel="alternate" hreflang="sr" href="https://localnotes-web.netlify.app/sr/">
    <link rel="alternate" hreflang="bs" href="https://localnotes-web.netlify.app/bs/">
    <link rel="alternate" hreflang="mk" href="https://localnotes-web.netlify.app/mk/">
    <link rel="alternate" hreflang="sl" href="https://localnotes-web.netlify.app/sl/">
    <link rel="alternate" hreflang="x-default" href="https://localnotes-web.netlify.app/">

    <title>Local Notes</title>
</head>

<body style="display: none;">

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVKPW88F" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- Header section - full width -->
    <div class="info-app">
        <span class="logo"></span>
        <h1 class="name-app">Local Notes</h1>
    </div>

    <!-- Navigation section - full width -->
    <div class="center_nav">
        <section class="sticky">
            <div class="block_btn">
                <button id="addNoteButton"><i class="fas fa-plus"></i> Add a note</button>
                <button id="importButton"><i class="fas fa-upload"></i> Import notes</button>
                <button id="clearAllButton"><i class="fas fa-trash-alt"></i> Clear all notes</button>
                <input multiple type="file" id="importInput" accept=".note">
            </div>
            <input type="text" id="searchInput" placeholder="Search notes...">
        </section>
    </div>

    <!-- Main content section -->
    <section class="app-notes-center">
        <section class="app-notes">
            <div class="btn_view_div">
                <button id="toggleViewButton"><i class="fas fa-th"></i> Toggle View</button>
            </div>

            <div class="notes_center">
                <div id="notesContainer" class="default-view"></div>
            </div>

            <!-- Modal for editing notes -->
            <div id="editModal" class="modal">
                <div class="modal-content">
                    <h2 class="modal_h2">Editor</h2>
                    <textarea id="editorContainer" class="tinymce"></textarea>
                    <div class="modal-buttons-container">
                        <button id="saveNoteButton"><i class="fas fa-save"></i> Save note</button>
                        <button id="cancelNoteButton" class="btn cancel"><i class="fas fa-times"></i> Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Confirmation modal -->
            <div id="confirmModal" class="modal">
                <div class="modal-content-error">
                    <p id="confirmMessage"></p>
                    <button id="confirmYes" class="btn"><i class="fas fa-check"></i> OK</button>
                    <button id="confirmNo" class="btn cancel"><i class="fas fa-times"></i> Cancel</button>
                </div>
            </div>

            <div id="error" class="modal">
                <div class="modal-content-error">
                    <button id="ok" class="btn cancel"><i class="fas fa-check"></i> OK</button>
                </div>
            </div>
        </section>

        <footer>
            <div class="info-about-project">
                <p id="footerDescription">
                    Local Notes is a simple and convenient tool for creating notes right in your browser. All notes are saved in your browser. Save your thoughts, ideas, and stories, structuring them with headings, text formatting, lists, and more. Export notes to an file and share them with friends anonymously - just send the file, and they can open it by importing it into the web application. With Local Notes, your notes are always at hand, organized, and secure.
                </p>
            </div>
            <div class="footer-content">
                <p id="cookie"></p>
                <br><br>
                <a href="/cookie.html" target="_blank" class="Cookie_Policy" id="cookiePolicyLink">Cookie Policy</a>
                <br> <br>
                <a href="/usage_policy.html" target="_blank" class="Usage_Policy" id="termsOfUseLink">Terms of Use</a>
                <br> <br>
                <a href="/privacy_policy.html" target="_blank" class="Privacy_Policy" id="privacyPolicyLink">Privacy Policy</a>
                <br><br>
                <a class="author" href="https://sergioplay-dev.netlify.app/" target="_blank" id="byAuthorLink">By SerGio Play</a></p>
                <br><br>
                <p>&copy; <span id="currentYear"></span><span class="footerCopyRight" id="allRightsReserved">All rights reserved. Local Notes</span></p>
            </div>
        </footer>
    </section>


    <!-- Critical JavaScript loaded first -->
    <script src="/js/utils.js"></script>
    <script src="/js/selectors.js"></script>
    <script src="/js/translate.js"></script>
    <script src="/js/themes.js"></script>
    <script src="/js/performance.js"></script>
    <script src="/js/security.js"></script>
    <script src="/lottiesnimstion/lottie.min.js"></script>
    <script src="/js/preloader.js"></script>
    
    <!-- TinyMCE loaded with defer for better performance -->
    <script src="/editor_news/tinymce.min.js" defer></script>
    
    <!-- Non-critical JavaScript loaded asynchronously -->
    <script>
        // Load non-critical scripts asynchronously
        function loadScript(src, callback) {
            const script = document.createElement('script');
            script.src = src;
            script.async = true;
            if (callback) script.onload = callback;
            document.head.appendChild(script);
        }
        
        // Load scripts after DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            loadScript('/js/magicurl.js');
            loadScript('/js/highlight.min.js');
            loadScript('/js/translations.js');
            loadScript('/js/tinymce-translations.js');
            loadScript('/js/img.js');
            loadScript('/js/date-utils.js');
            
            // Load main script last
            loadScript('/js/index.js');
        });
    </script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('Service Worker registered successfully:', registration.scope);
                        
                        // Проверка обновлений
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Новый Service Worker доступен
                                    if (confirm('Доступно обновление приложения. Перезагрузить страницу?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(function(error) {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>

</body>

</html>
